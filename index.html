<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NearGo</title>
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <!-- FullCalendar CSS (Core, DayGrid, TimeGrid) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/core@6.1.19/index.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.19/index.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.19/index.min.css" />
  <style>
    /* Global Styles & Light/Dark Theme Variables */
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --header-bg: #f8f9fa;
      --header-text: #000000;
      --primary-color: #007bff;
      --secondary-color: #6c757d;
    }
    body.dark-mode {
      --bg-color: #2b2b2b;
      --text-color: #e0e0e0;
      --header-bg: #343a40;
      --header-text: #ffffff;
      --primary-color: #66aaff;
      --secondary-color: #aaaaaa;
    }
    body {
      margin: 0;
      background: var(--bg-color);
      color: var(--text-color);
      font-family: Arial, sans-serif;
    }
    /* Header Styles */
    #header-top {
      background: var(--header-bg);
      color: var(--header-text);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 5px 10px;
      border-bottom: 1px solid #ccc;
    }
    #logo {
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 1;
      text-align: center;
    }
    #logo img {
      height: 30px;
      margin-right: 5px;
      vertical-align: middle;
    }
    #logo .app-name {
      font-size: 1.2em;
      font-weight: bold;
      vertical-align: middle;
    }
    #header-top .left-controls, #header-top .right-controls {
      display: flex;
      align-items: center;
    }
    #header-top .left-controls {
      justify-content: flex-start;
    }
    #header-top .right-controls {
      justify-content: flex-end;
    }
    .header-btn {
      background: none;
      border: none;
      color: var(--header-text);
      cursor: pointer;
      font-size: 1em;
      margin: 0 5px;
    }
    .header-btn:hover {
      text-decoration: underline;
    }
    /* Language selector as a basic select for simplicity */
    #languageSelect {
      margin-left: 5px;
      padding: 2px;
      font-size: 1em;
    }
    /* Second line nav */
    #header-nav {
      background: var(--header-bg);
      display: flex;
      justify-content: center;
      border-bottom: 1px solid #ccc;
    }
    #header-nav a {
      color: var(--header-text);
      text-decoration: none;
      padding: 10px 15px;
      display: inline-block;
      font-weight: normal;
    }
    #header-nav a:hover {
      background: var(--secondary-color);
      color: var(--header-text);
    }
    #header-nav a.active {
      font-weight: bold;
      text-decoration: underline;
    }
    /* Main content sections */
    section {
      display: none;
      padding: 15px;
    }
    section.active-section {
      display: block;
    }
    /* Intro text and featured section */
    .intro {
      font-size: 1.1em;
      margin-bottom: 10px;
    }
    .featured-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    .featured-item {
      border: 1px solid #ccc;
      border-radius: 5px;
      overflow: hidden;
      width: calc(33% - 10px);
      min-width: 200px;
      background: #fdfdfd;
      transition: transform 0.2s;
    }
    .featured-item:hover {
      transform: scale(1.02);
    }
    .featured-item img {
      width: 100%;
      display: block;
      height: 120px;
      object-fit: cover;
    }
    .featured-item .featured-info {
      padding: 5px;
    }
    .featured-item .featured-title {
      font-weight: bold;
    }
    .featured-item .featured-desc {
      font-size: 0.9em;
      color: #555;
    }
    /* Search & Map section */
    .search-controls {
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 5px;
    }
    .search-controls label {
      margin-right: 5px;
    }
    .search-controls input[type=text], .search-controls select {
      padding: 4px;
      font-size: 1em;
    }
    .search-controls input[type=number] {
      width: 80px;
      padding: 4px;
      font-size: 1em;
    }
    .search-controls button {
      padding: 5px 10px;
      font-size: 1em;
      cursor: pointer;
    }
    /* Map containers */
    #mapEvents, #mapServices {
      width: 100%;
      height: 400px;
      margin-bottom: 20px;
    }
    /* Modal (For providers form) */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: var(--bg-color);
      color: var(--text-color);
      width: 80%;
      max-width: 800px;
      max-height: 90%;
      overflow-y: auto;
      border-radius: 5px;
      padding: 20px;
      position: relative;
    }
    .modal-content h2 {
      margin-top: 0;
    }
    .close-button {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 1.5em;
      cursor: pointer;
      color: var(--text-color);
    }
    /* Form styles */
    .form-section {
      margin-bottom: 15px;
      border-top: 1px solid #ddd;
      padding-top: 10px;
    }
    .form-section:first-child {
      border-top: none;
      padding-top: 0;
    }
    .form-section h3 {
      margin-bottom: 5px;
      font-size: 1.1em;
      border-bottom: 1px solid #ccc;
      padding-bottom: 3px;
    }
    .form-group {
      margin-bottom: 8px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
    }
    .form-group label {
      flex: 0 0 120px;
      font-weight: bold;
      margin-right: 5px;
    }
    .form-group input, .form-group textarea, .form-group select {
      flex: 1;
      padding: 4px;
      font-size: 1em;
    }
    .form-group textarea {
      min-height: 60px;
    }
    /* Radio buttons styling (making them visually distinct if needed) */
    .radio-group {
      display: flex;
      gap: 20px;
      margin-top: 5px;
    }
    .radio-group label {
      display: flex;
      align-items: center;
      cursor: pointer;
    }
    .radio-group input {
      margin-right: 5px;
    }
    /* Image preview thumbnails */
    .preview-container {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 5px;
    }
    .preview-container img {
      max-width: 100px;
      max-height: 100px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }
    /* Tab toggle in modal for event/service */
    .toggle-add-type {
      text-align: center;
      margin-bottom: 15px;
    }
    .toggle-add-type button {
      padding: 5px 10px;
      margin: 0 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .toggle-add-type button.active {
      text-decoration: underline;
    }
    /* Adjustments for dark mode in some elements */
    body.dark-mode .featured-item {
      background: #444;
      border-color: #666;
    }
    body.dark-mode .featured-item .featured-desc {
      color: #ccc;
    }
    body.dark-mode .modal-content {
      background: #3a3a3a;
      color: #eaeaea;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div id="header-top">
    <div class="left-controls">
      <!-- Night mode toggle -->
      <button id="nightToggle" class="header-btn" title="Toggle night mode">üåô</button>
      <!-- Language selector -->
      <select id="languageSelect" class="header-btn" title="Select language">
        <!-- Language options will be populated by script -->
      </select>
    </div>
    <div id="logo">
      <!-- Logo image placeholder -->
      <!-- <img src="neargo-logo.png" alt="NearGo Logo"> -->
      <span class="app-name">NearGo</span>
    </div>
    <div class="right-controls">
      <button id="providerButton" class="header-btn"><span data-i18n="providers">For Providers</span></button>
    </div>
  </div>
  <div id="header-nav">
    <a href="javascript:void(0)" id="eventsTab" class="nav-link active" data-section="eventsSection"><span data-i18n="events">Events</span></a>
    <a href="javascript:void(0)" id="servicesTab" class="nav-link" data-section="servicesSection"><span data-i18n="services">Services</span></a>
    <a href="javascript:void(0)" id="premiumTab" class="nav-link" data-section="premiumSection"><span data-i18n="premium">Premium</span></a>
    <a href="javascript:void(0)" id="myTab" class="nav-link" data-section="mySection"><span data-i18n="my">My</span></a>
  </div>
  <!-- Main Sections -->
  <section id="eventsSection" class="active-section">
    <p class="intro" data-i18n="intro_events">Find and explore events near you. Whether concerts, sports or workshops, discover what's happening in your area.</p>
    <div class="featured-container">
      <!-- Featured events -->
      <div class="featured-item">
        <img src="https://placehold.co/300x120/skyblue/white.png?text=Event+1" alt="Featured Event 1">
        <div class="featured-info">
          <div class="featured-title">Music Festival</div>
          <div class="featured-desc">Celje - July 5, 2025</div>
        </div>
      </div>
      <div class="featured-item">
        <img src="https://placehold.co/300x120/skyblue/white.png?text=Event+2" alt="Featured Event 2">
        <div class="featured-info">
          <div class="featured-title">City Marathon</div>
          <div class="featured-desc">Ljubljana - Sept 20, 2025</div>
        </div>
      </div>
      <div class="featured-item">
        <img src="https://placehold.co/300x120/skyblue/white.png?text=Event+3" alt="Featured Event 3">
        <div class="featured-info">
          <div class="featured-title">Art Workshop</div>
          <div class="featured-desc">Maribor - Aug 12, 2025</div>
        </div>
      </div>
    </div>
    <!-- Search filters and map for events -->
    <div class="search-controls">
      <label for="eventLocationInput" data-i18n="location">Location</label>
      <input type="text" id="eventLocationInput" placeholder="" />
      <button id="eventUseLocationBtn" type="button" title="Use current location"><span data-i18n="use_location">Use my location</span></button>
      <label for="eventRadiusInput" data-i18n="radius">Radius (km)</label>
      <input type="number" id="eventRadiusInput" value="50" min="0" />
      <label for="eventCategorySelect" data-i18n="category">Category</label>
      <select id="eventCategorySelect">
        <option value="all" data-i18n="cat_all">All</option>
        <option value="music" data-i18n="cat_music">Music</option>
        <option value="sports" data-i18n="cat_sports">Sports</option>
        <option value="workshops" data-i18n="cat_workshops">Workshops</option>
        <option value="other" data-i18n="cat_other">Other</option>
      </select>
      <button id="eventFilterBtn" type="button"><span data-i18n="search">Search</span></button>
    </div>
    <div id="mapEvents"></div>
  </section>
  <section id="servicesSection">
    <p class="intro" data-i18n="intro_services">Find the services you need nearby. From food and entertainment to repairs and wellness, discover providers around you.</p>
    <div class="featured-container">
      <!-- Featured services -->
      <div class="featured-item">
        <img src="https://placehold.co/300x120/orange/black.png?text=Service+1" alt="Featured Service 1">
        <div class="featured-info">
          <div class="featured-title">Italian Restaurant</div>
          <div class="featured-desc">Celje - ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
        </div>
      </div>
      <div class="featured-item">
        <img src="https://placehold.co/300x120/orange/black.png?text=Service+2" alt="Featured Service 2">
        <div class="featured-info">
          <div class="featured-title">Electrician Service</div>
          <div class="featured-desc">Maribor - ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
        </div>
      </div>
      <div class="featured-item">
        <img src="https://placehold.co/300x120/orange/black.png?text=Service+3" alt="Featured Service 3">
        <div class="featured-info">
          <div class="featured-title">Yoga Studio</div>
          <div class="featured-desc">Ljubljana - ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
        </div>
      </div>
    </div>
    <!-- Search filters and map for services -->
    <div class="search-controls">
      <label for="serviceLocationInput" data-i18n="location">Location</label>
      <input type="text" id="serviceLocationInput" placeholder="" />
      <button id="serviceUseLocationBtn" type="button" title="Use current location"><span data-i18n="use_location">Use my location</span></button>
      <label for="serviceRadiusInput" data-i18n="radius">Radius (km)</label>
      <input type="number" id="serviceRadiusInput" value="50" min="0" />
      <label for="serviceCategorySelect" data-i18n="category">Category</label>
      <select id="serviceCategorySelect">
        <option value="all" data-i18n="cat_all">All</option>
        <option value="food" data-i18n="cat_food">Food</option>
        <option value="repair" data-i18n="cat_repair">Repair</option>
        <option value="health" data-i18n="cat_health">Health</option>
        <option value="other" data-i18n="cat_other">Other</option>
      </select>
      <button id="serviceFilterBtn" type="button"><span data-i18n="search">Search</span></button>
    </div>
    <div id="mapServices"></div>
  </section>
  <section id="premiumSection">
    <h3><span data-i18n="premium">Premium</span></h3>
    <p data-i18n="premium_info">Go Premium to enjoy additional benefits like priority listing, ad-free experience, and more.</p>
    <button type="button"><span data-i18n="upgrade_btn">Upgrade to Premium</span></button>
  </section>
  <section id="mySection">
    <h3><span data-i18n="my">My</span></h3>
    <p data-i18n="my_info">Your personalized content will appear here (favorites, profile, etc).</p>
  </section>
  <!-- For Providers Modal -->
  <div id="providerModal" class="modal">
    <div class="modal-content">
      <span id="closeModalBtn" class="close-button">&times;</span>
      <h2><span data-i18n="providers">For Providers</span></h2>
      <div class="toggle-add-type">
        <span data-i18n="choose_add">Add new:</span>
        <button id="toggleEventForm" class="active"><span data-i18n="add_event_btn">Event</span></button>
        <button id="toggleServiceForm"><span data-i18n="add_service_btn">Service</span></button>
      </div>
      <!-- Event Form -->
      <form id="eventForm">
        <div class="form-section">
          <h3 data-i18n="events">Events</h3>
          <div class="form-group">
            <label for="eventTitle" data-i18n="title">Title</label>
            <input type="text" id="eventTitle" required>
          </div>
          <div class="form-group">
            <label for="eventDescription" data-i18n="description">Description</label>
            <textarea id="eventDescription" required></textarea>
          </div>
          <div class="form-group">
            <label for="eventCategory" data-i18n="category">Category</label>
            <select id="eventCategory">
              <option value="music" data-i18n="cat_music">Music</option>
              <option value="sports" data-i18n="cat_sports">Sports</option>
              <option value="workshops" data-i18n="cat_workshops">Workshops</option>
              <option value="other" data-i18n="cat_other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="eventLocation" data-i18n="location">Location</label>
            <input type="text" id="eventLocation" required>
          </div>
          <div class="form-group">
            <label for="eventPrice" data-i18n="price">Price</label>
            <input type="number" id="eventPrice" min="0" step="0.01" placeholder="0.00">
          </div>
        </div>
        <div class="form-section">
          <h3 data-i18n="availability">Availability</h3>
          <div class="form-group">
            <label for="eventStart" data-i18n="start_datetime">Start Date/Time</label>
            <input type="datetime-local" id="eventStart" required>
          </div>
          <div class="form-group">
            <label for="eventEnd" data-i18n="end_datetime">End Date/Time</label>
            <input type="datetime-local" id="eventEnd">
          </div>
          <div class="form-group">
            <label for="eventCoupon" data-i18n="coupon">Coupon Code</label>
            <input type="text" id="eventCoupon" placeholder="">
          </div>
        </div>
        <div class="form-section">
          <h3 data-i18n="images">Images</h3>
          <div class="form-group">
            <label for="eventImages" data-i18n="images">Images</label>
            <input type="file" id="eventImages" accept="image/*" multiple>
          </div>
          <div id="eventImagesPreview" class="preview-container"></div>
        </div>
        <button type="submit" id="submitEventBtn"><span data-i18n="search">Submit</span></button>
      </form>
      <!-- Service Form -->
      <form id="serviceForm" style="display:none;">
        <div class="form-section">
          <h3 data-i18n="services">Services</h3>
          <div class="form-group">
            <label for="serviceTitle" data-i18n="title">Title</label>
            <input type="text" id="serviceTitle" required>
          </div>
          <div class="form-group">
            <label for="serviceDescription" data-i18n="description">Description</label>
            <textarea id="serviceDescription" required></textarea>
          </div>
          <div class="form-group">
            <label for="serviceCategory" data-i18n="category">Category</label>
            <select id="serviceCategory">
              <option value="food" data-i18n="cat_food">Food</option>
              <option value="repair" data-i18n="cat_repair">Repair</option>
              <option value="health" data-i18n="cat_health">Health</option>
              <option value="other" data-i18n="cat_other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="serviceLocationField" data-i18n="location">Location</label>
            <input type="text" id="serviceLocationField" required>
          </div>
          <div class="form-group">
            <label for="servicePrice" data-i18n="price">Price</label>
            <input type="number" id="servicePrice" min="0" step="0.01" placeholder="0.00">
          </div>
        </div>
        <div class="form-section">
          <h3 data-i18n="availability">Availability</h3>
          <div class="form-group">
            <label data-i18n="availability">Availability</label>
            <div class="radio-group">
              <label><input type="radio" name="serviceAvailability" value="unlimited" checked> <span data-i18n="unlimited">Unlimited</span></label>
              <label><input type="radio" name="serviceAvailability" value="limited"> <span data-i18n="specific">Specific appointments</span></label>
            </div>
          </div>
          <div class="form-group" id="serviceCouponGroup">
            <label for="serviceCoupon" data-i18n="coupon">Coupon Code</label>
            <input type="text" id="serviceCoupon" placeholder="">
          </div>
          <div class="form-group" id="calendarGroup" style="display:none;">
            <label data-i18n="specific">Specific appointments</label>
            <div id="calendar" style="max-width: 600px; margin: 10px 0;"></div>
          </div>
        </div>
        <div class="form-section">
          <h3 data-i18n="images">Images</h3>
          <div class="form-group">
            <label for="serviceImages" data-i18n="images">Images</label>
            <input type="file" id="serviceImages" accept="image/*" multiple>
          </div>
          <div id="serviceImagesPreview" class="preview-container"></div>
        </div>
        <button type="submit" id="submitServiceBtn"><span data-i18n="search">Submit</span></button>
      </form>
    </div>
  </div>
  <!-- Scripts -->
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <!-- FullCalendar JS (standard bundle includes core, interaction, daygrid, timegrid plugins per docsÓ®Å1Ó®Ç) -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js"></script>
  <script>
    // Translation resources for i18n (18 languages support can be added similarly)
    const translations = {
      en: {
        events: "Events", services: "Services", premium: "Premium", my: "My", providers: "For Providers",
        intro_events: "Find and explore events near you. Whether concerts, sports or workshops, discover what's happening in your area.",
        intro_services: "Find the services you need nearby. From food and entertainment to repairs and wellness, discover providers around you.",
        search: "Search", location: "Location", radius: "Radius (km)", category: "Category", use_location: "Use my location",
        title: "Title", description: "Description", price: "Price", availability: "Availability",
        unlimited: "Unlimited", specific: "Specific appointments", coupon: "Coupon Code", images: "Images",
        start_datetime: "Start Date/Time", end_datetime: "End Date/Time",
        cat_all: "All", cat_music: "Music", cat_sports: "Sports", cat_workshops: "Workshops", cat_other: "Other",
        cat_food: "Food", cat_repair: "Repair", cat_health: "Health",
        choose_add: "Add new:", add_event_btn: "Event", add_service_btn: "Service",
        premium_info: "Go Premium to enjoy additional benefits like priority listing, ad-free experience, and more.",
        upgrade_btn: "Upgrade to Premium",
        my_info: "Your personalized content will appear here (favorites, profile, etc)."
      },
      sl: {
        events: "Dogodki", services: "Storitve", premium: "Premium", my: "Moje", providers: "Za ponudnike",
        intro_events: "Poi≈°ƒçi in razi≈°ƒçi dogodke v svoji bli≈æini. Ne glede na to, ali gre za koncerte, ≈°port ali delavnice ‚Äì odkrij, kaj se dogaja v tvoji okolici.",
        intro_services: "Najdi storitve, ki jih potrebuje≈° v bli≈æini. Od hrane in zabave do popravil in zdravja ‚Äì odkrij ponudnike v svoji okolici.",
        search: "I≈°ƒçi", location: "Lokacija", radius: "Radij (km)", category: "Kategorija", use_location: "Uporabi mojo lokacijo",
        title: "Naslov", description: "Opis", price: "Cena", availability: "Razpolo≈æljivost",
        unlimited: "Neomejeno", specific: "Doloƒçeni termini", coupon: "Koda kupona", images: "Slike",
        start_datetime: "Zaƒçetek", end_datetime: "Konec",
        cat_all: "Vse", cat_music: "Glasba", cat_sports: "≈†port", cat_workshops: "Delavnice", cat_other: "Drugo",
        cat_food: "Hrana", cat_repair: "Popravila", cat_health: "Zdravje",
        choose_add: "Dodaj:", add_event_btn: "Dogodek", add_service_btn: "Storitev",
        premium_info: "Postanite Premium uporabnik in u≈æivajte v dodatnih ugodnostih, kot so prednostna izpostavljenost, do≈æivetje brez oglasov in drugo.",
        upgrade_btn: "Nadgradi na Premium",
        my_info: "Tukaj se bodo prikazale va≈°e prilagojene vsebine (priljubljene, profil itd.)."
      }
      // Additional languages can be added here...
    };
    let currentLang = 'en';
    // Apply translations to all elements with data-i18n attribute
    function applyTranslations() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if(translations[currentLang] && translations[currentLang][key]) {
          el.textContent = translations[currentLang][key];
        }
      });
    }
    // Set language (and update UI text)
    function setLanguage(lang) {
      if(translations[lang]) {
        currentLang = lang;
        applyTranslations();
      }
    }
    // Save chosen language to local storage
    function saveLanguagePreference(lang) {
      try {
        localStorage.setItem('preferredLang', lang);
      } catch(e) {}
    }
    // Initialize language selection dropdown
    function initLanguageSelector() {
      const select = document.getElementById('languageSelect');
      // Populate options from available translations keys
      for(const langCode in translations) {
        const opt = document.createElement('option');
        opt.value = langCode;
        // Use native language name or code as text
        // For simplicity, using language code in uppercase as label
        opt.textContent = langCode.toUpperCase();
        select.appendChild(opt);
      }
      // Set current selection
      select.value = currentLang;
      // Handle change
      select.addEventListener('change', () => {
        setLanguage(select.value);
        saveLanguagePreference(select.value);
        // If calendar exists, update locale
        if(window.calendar) {
          calendar.setOption('locale', currentLang);
        }
      });
    }
    // Night mode toggle
    const nightToggleBtn = document.getElementById('nightToggle');
    function updateNightModeIcon() {
      nightToggleBtn.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
    }
    nightToggleBtn.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      try {
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
      } catch(e) {}
      updateNightModeIcon();
    });
    // Navigation tab switching
    const sections = {
      eventsSection: document.getElementById('eventsSection'),
      servicesSection: document.getElementById('servicesSection'),
      premiumSection: document.getElementById('premiumSection'),
      mySection: document.getElementById('mySection')
    };
    const navLinks = document.querySelectorAll('#header-nav .nav-link');
    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        const targetId = link.getAttribute('data-section');
        // Show target section, hide others
        for(const secId in sections) {
          sections[secId].style.display = (secId === targetId) ? 'block' : 'none';
        }
        // Update active class on nav
        navLinks.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        // If showing map section and map not initialized, initialize it
        if(targetId === 'servicesSection' && !servicesMap) {
          initServiceMap();
        }
        if(targetId === 'eventsSection' && !eventsMap) {
          initEventMap();
        }
        // If switching to services or events, perhaps mirror filter criteria
        if(targetId === 'servicesSection' && currentLocation) {
          // Apply existing location filter to service map
          document.getElementById('serviceRadiusInput').value = document.getElementById('eventRadiusInput').value;
          document.getElementById('serviceCategorySelect').value = document.getElementById('eventCategorySelect').value;
          updateServicesMap();
        }
        if(targetId === 'eventsSection' && currentLocation) {
          document.getElementById('eventRadiusInput').value = document.getElementById('serviceRadiusInput').value;
          document.getElementById('eventCategorySelect').value = document.getElementById('serviceCategorySelect').value;
          updateEventsMap();
        }
      });
    });
    // Provider modal handling
    const providerModal = document.getElementById('providerModal');
    const providerBtn = document.getElementById('providerButton');
    const closeModalBtn = document.getElementById('closeModalBtn');
    providerBtn.addEventListener('click', () => {
      providerModal.style.display = 'flex';
    });
    closeModalBtn.addEventListener('click', () => {
      providerModal.style.display = 'none';
    });
    window.addEventListener('click', (e) => {
      if(e.target === providerModal) {
        providerModal.style.display = 'none';
      }
    });
    // Toggle between Event and Service forms in modal
    const toggleEventBtn = document.getElementById('toggleEventForm');
    const toggleServiceBtn = document.getElementById('toggleServiceForm');
    const eventFormEl = document.getElementById('eventForm');
    const serviceFormEl = document.getElementById('serviceForm');
    toggleEventBtn.addEventListener('click', () => {
      toggleEventBtn.classList.add('active');
      toggleServiceBtn.classList.remove('active');
      eventFormEl.style.display = 'block';
      serviceFormEl.style.display = 'none';
    });
    toggleServiceBtn.addEventListener('click', () => {
      toggleServiceBtn.classList.add('active');
      toggleEventBtn.classList.remove('active');
      eventFormEl.style.display = 'none';
      serviceFormEl.style.display = 'block';
    });
    // FullCalendar for service specific appointments
    let calendar; 
    let calendarInitialized = false;
    function initCalendar() {
      const calendarEl = document.getElementById('calendar');
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'timeGridWeek',
        selectable: true,
        headerToolbar: { left: 'title', center: '', right: 'today prev,next' },
        locale: currentLang
      });
      calendar.render();
    }
    // Radio buttons for service availability
    const serviceAvailRadios = document.querySelectorAll('input[name="serviceAvailability"]');
    const serviceCouponGroup = document.getElementById('serviceCouponGroup');
    const calendarGroup = document.getElementById('calendarGroup');
    serviceAvailRadios.forEach(radio => {
      radio.addEventListener('change', () => {
        if(radio.value === 'unlimited') {
          serviceCouponGroup.style.display = 'block';
          calendarGroup.style.display = 'none';
        } else if(radio.value === 'limited') {
          serviceCouponGroup.style.display = 'none';
          calendarGroup.style.display = 'block';
          if(!calendarInitialized) {
            initCalendar();
            calendarInitialized = true;
          }
        }
      });
    });
    // Image preview for file inputs (eventImages and serviceImages)
    function previewImages(inputElement, previewContainer) {
      previewContainer.innerHTML = '';
      const files = inputElement.files;
      for(let i=0; i < files.length; i++) {
        const file = files[i];
        if(file.type.startsWith('image/')) {
          const img = document.createElement('img');
          img.src = URL.createObjectURL(file);
          img.onload = () => URL.revokeObjectURL(img.src);
          previewContainer.appendChild(img);
        }
      }
    }
    document.getElementById('eventImages').addEventListener('change', function() {
      previewImages(this, document.getElementById('eventImagesPreview'));
    });
    document.getElementById('serviceImages').addEventListener('change', function() {
      previewImages(this, document.getElementById('serviceImagesPreview'));
    });
    // Dummy form submit handlers (to prevent actual submission and simulate behavior)
    document.getElementById('eventForm').addEventListener('submit', (e) => {
      e.preventDefault();
      alert('Event submitted (demo).');  // In real app, trigger event confirmation email
      providerModal.style.display = 'none';
    });
    document.getElementById('serviceForm').addEventListener('submit', (e) => {
      e.preventDefault();
      alert('Service submitted (demo).');  // In real app, trigger service confirmation email
      providerModal.style.display = 'none';
    });
    // Map and search functionality
    let eventsMap, servicesMap;
    let currentLocation = null;
    let eventsLayer, servicesLayer;
    let userMarkerEvents, userMarkerServices;
    let radiusCircleEvents, radiusCircleServices;
    // Dummy data for events and services
    const eventsData = [
      { name: "Music Festival", category: "music", city: "Celje", lat: 46.23, lng: 15.27 },
      { name: "City Marathon", category: "sports", city: "Ljubljana", lat: 46.05, lng: 14.50 },
      { name: "Art Workshop", category: "workshops", city: "Maribor", lat: 46.56, lng: 15.65 }
    ];
    const servicesData = [
      { name: "Italian Restaurant", category: "food", city: "Celje", lat: 46.23, lng: 15.26 },
      { name: "Electrician Service", category: "repair", city: "Maribor", lat: 46.55, lng: 15.64 },
      { name: "Yoga Studio", category: "health", city: "Ljubljana", lat: 46.06, lng: 14.51 }
    ];
    // Initialize Leaflet map for Events
    function initEventMap() {
      eventsMap = L.map('mapEvents').setView([46.23, 15.26], 8);
      // Add OSM tile layer with attributionÓ®Å2Ó®Ç
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(eventsMap);
      eventsLayer = L.layerGroup().addTo(eventsMap);
      updateEventsMap(); // initial marker load
    }
    // Initialize Leaflet map for Services
    function initServiceMap() {
      servicesMap = L.map('mapServices').setView([46.23, 15.26], 8);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(servicesMap);
      servicesLayer = L.layerGroup().addTo(servicesMap);
      updateServicesMap();
    }
    // Helper: calculate distance between two coords (in meters)
    function distanceInMeters(lat1, lng1, lat2, lng2) {
      return L.latLng(lat1, lng1).distanceTo([lat2, lat2]);
    }
    // Update events map markers based on current filters
    function updateEventsMap() {
      if(!eventsMap) return;
      eventsLayer.clearLayers();
      if(radiusCircleEvents) {
        eventsMap.removeLayer(radiusCircleEvents);
        radiusCircleEvents = null;
      }
      let centerLat = eventsMap.getCenter().lat;
      let centerLng = eventsMap.getCenter().lng;
      const radiusKm = parseFloat(document.getElementById('eventRadiusInput').value) || 0;
      const categoryFilter = document.getElementById('eventCategorySelect').value;
      if(currentLocation) {
        centerLat = currentLocation.lat;
        centerLng = currentLocation.lng;
        eventsMap.setView([centerLat, centerLng]);
      }
      // If radius > 0, add circle
      if(radiusKm > 0) {
        radiusCircleEvents = L.circle([centerLat, centerLng], {
          radius: radiusKm * 1000,
          color: 'blue',
          fillColor: 'blue',
          fillOpacity: 0.1
        }).addTo(eventsMap);  // draw radius circleÓ®Å3Ó®Ç
      }
      // Add markers within radius (or all if radius=0)
      eventsData.forEach(item => {
        const dist = distanceInMeters(centerLat, centerLng, item.lat, item.lng);
        if(radiusKm === 0 || dist <= radiusKm * 1000) {
          if(categoryFilter === 'all' || item.category === categoryFilter) {
            const marker = L.marker([item.lat, item.lng]).addTo(eventsLayer);
            marker.bindPopup(item.name + (item.city ? ' - ' + item.city : ''));
          }
        }
      });
      // Fit map to show all markers or the radius circle
      if(radiusCircleEvents) {
        eventsMap.fitBounds(radiusCircleEvents.getBounds());
      } else if(eventsLayer.getLayers().length > 0) {
        eventsMap.fitBounds(eventsLayer.getBounds());
      }
      // Add user location marker if available
      if(currentLocation && !userMarkerEvents) {
        userMarkerEvents = L.circleMarker([currentLocation.lat, currentLocation.lng], {
          radius: 6, color: 'red', fillColor: 'red', fillOpacity: 1
        }).addTo(eventsMap);
        userMarkerEvents.bindPopup('You are here').openPopup();
      }
    }
    // Update services map markers based on filters
    function updateServicesMap() {
      if(!servicesMap) return;
      servicesLayer.clearLayers();
      if(radiusCircleServices) {
        servicesMap.removeLayer(radiusCircleServices);
        radiusCircleServices = null;
      }
      let centerLat = servicesMap.getCenter().lat;
      let centerLng = servicesMap.getCenter().lng;
      const radiusKm = parseFloat(document.getElementById('serviceRadiusInput').value) || 0;
      const categoryFilter = document.getElementById('serviceCategorySelect').value;
      if(currentLocation) {
        centerLat = currentLocation.lat;
        centerLng = currentLocation.lng;
        servicesMap.setView([centerLat, centerLng]);
      }
      if(radiusKm > 0) {
        radiusCircleServices = L.circle([centerLat, centerLng], {
          radius: radiusKm * 1000,
          color: 'blue',
          fillColor: 'blue',
          fillOpacity: 0.1
        }).addTo(servicesMap);  // draw radius circleÓ®Å4Ó®Ç
      }
      servicesData.forEach(item => {
        const dist = distanceInMeters(centerLat, centerLng, item.lat, item.lng);
        if(radiusKm === 0 || dist <= radiusKm * 1000) {
          if(categoryFilter === 'all' || item.category === categoryFilter) {
            const marker = L.marker([item.lat, item.lng]).addTo(servicesLayer);
            marker.bindPopup(item.name + (item.city ? ' - ' + item.city : ''));
          }
        }
      });
      if(radiusCircleServices) {
        servicesMap.fitBounds(radiusCircleServices.getBounds());
      } else if(servicesLayer.getLayers().length > 0) {
        servicesMap.fitBounds(servicesLayer.getBounds());
      }
      if(currentLocation && !userMarkerServices) {
        userMarkerServices = L.circleMarker([currentLocation.lat, currentLocation.lng], {
          radius: 6, color: 'red', fillColor: 'red', fillOpacity: 1
        }).addTo(servicesMap);
        userMarkerServices.bindPopup('You are here').openPopup();
      }
    }
    // Filter button events
    document.getElementById('eventFilterBtn').addEventListener('click', () => {
      handleLocationSearch(true);
      updateEventsMap();
    });
    document.getElementById('serviceFilterBtn').addEventListener('click', () => {
      handleLocationSearch(false);
      updateServicesMap();
    });
    // Allow pressing Enter in location inputs to trigger filter
    document.getElementById('eventLocationInput').addEventListener('keydown', (e) => {
      if(e.key === 'Enter') {
        e.preventDefault();
        handleLocationSearch(true);
        updateEventsMap();
      }
    });
    document.getElementById('serviceLocationInput').addEventListener('keydown', (e) => {
      if(e.key === 'Enter') {
        e.preventDefault();
        handleLocationSearch(false);
        updateServicesMap();
      }
    });
    // Known locations for simple text input matching to coords
    const locationLookup = {
      "celje": { lat: 46.23, lng: 15.26 },
      "ljubljana": { lat: 46.05, lng: 14.50 },
      "maribor": { lat: 46.56, lng: 15.65 }
    };
    function handleLocationSearch(isEvent) {
      const input = document.getElementById(isEvent ? 'eventLocationInput' : 'serviceLocationInput');
      const query = input.value.trim().toLowerCase();
      if(query && locationLookup[query]) {
        currentLocation = locationLookup[query];
      } else {
        if(query && !locationLookup[query]) {
          alert('Location not recognized (demo).');
        }
      }
    }
    // Use current location (geolocation)
    function geolocateAndUpdate(isEvent) {
      if(navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
          currentLocation = { lat: pos.coords.latitude, lng: pos.coords.longitude };
          if(isEvent) {
            updateEventsMap();
          } else {
            updateServicesMap();
          }
        }, err => {
          alert('Geolocation not available.');
        });
      } else {
        alert('Geolocation not supported by this browser.');
      }
    }
    document.getElementById('eventUseLocationBtn').addEventListener('click', () => {
      geolocateAndUpdate(true);
    });
    document.getElementById('serviceUseLocationBtn').addEventListener('click', () => {
      geolocateAndUpdate(false);
    });
    // Language and theme initialization on page load
    document.addEventListener('DOMContentLoaded', () => {
      // Set theme from storage
      try {
        if(localStorage.getItem('darkMode') === 'true') {
          document.body.classList.add('dark-mode');
        }
      } catch(e){}
      updateNightModeIcon();
      // Set language from storage or auto-detect
      let lang = 'en';
      try {
        lang = localStorage.getItem('preferredLang') || navigator.language || 'en';
      } catch(e) {
        lang = navigator.language || 'en';
      }
      lang = lang.substring(0,2).toLowerCase();
      if(!translations[lang]) lang = 'en';
      setLanguage(lang);
      initLanguageSelector();
      // Initialize event map by default
      initEventMap();
      // Attempt auto-geolocation on load for convenience
      geolocateAndUpdate(true);
    });
  </script>
</body>
</html>
