<!doctype html>
<html lang="sl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Moj kupon</title>
<style>
  body{font:16px/1.5 system-ui, Arial; margin:24px; color:#111}
  .card{max-width:560px;margin:auto;padding:20px;border:1px solid #eee;border-radius:14px;box-shadow:0 4px 16px rgba(0,0,0,.05)}
  .qr{display:block;margin:12px auto;width:240px;height:240px}
  .mono{font:12px/1.4 ui-monospace, Menlo, monospace; word-break:break-all; color:#666}
  .pill{display:inline-block;border-radius:999px;padding:2px 10px;border:1px solid #ddd;font-size:12px;margin:2px 0;color:#444}
</style>
</head>
<body>
<div class="card">
  <h2 id="title">Kupon</h2>
  <img id="qr" class="qr" alt="QR">
  <div id="chips"></div>
  <div class="mono" id="token"></div>
</div>
<script>
(async function(){
  const token = new URLSearchParams(location.search).get('token');
  if(!token){ document.getElementById('title').textContent='Manjka token.'; return; }
  const res = await fetch('/.netlify/functions/get-coupon?token='+encodeURIComponent(token));
  const data = await res.json();
  if(!data.ok){ document.getElementById('title').textContent='Kupon ni najden ali je neveljaven.'; return; }
  document.getElementById('qr').src = data.qr;
  document.getElementById('token').textContent = token;
  const c = data.coupon || {};
  document.getElementById('title').textContent = c.title || 'Kupon';
  const parts = [];
  if(c.kind==='PERCENT') parts.push(`Popust ${c.percentOff}%`);
  if(c.kind==='VALUE')   parts.push(`Vrednost €${Number(c.valueEur||0).toFixed(2)}`);
  if(c.kind==='FREEBIE') parts.push(`Brezplačno: ${c.freebieLabel}`);
  parts.push(`Status: ${data.status}`);
  if(c.validTo) parts.push(`Velja do: ${new Date(c.validTo).toLocaleString()}`);
  document.getElementById('chips').innerHTML = parts.map(p=>`<span class="pill">${p}</span>`).join(' ');
})();
</script>
</body>
</html>
