<!doctype html>
<html lang="sl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NearGo – najdi dogodke blizu</title>

  <!-- Leaflet -->
  <link rel="preconnect" href="https://unpkg.com">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root{
      --brand:#0bbbd6; --text:#0b1b2b; --muted:#5b6b7b; --card:#fff;
      --chip:#fff; --chipborder:#cfe1ee; --shadow:0 10px 30px rgba(0,0,0,.08);
      --radius:16px; --primary:#0bbbd6; --focus:#bfeef6; --gap:16px;
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;background:#f6fbfd;color:var(--text)}
    .appbar{position:sticky;top:0;z-index:50;background:var(--brand);color:#fff;display:flex;align-items:center;gap:12px;padding:14px 18px;box-shadow:var(--shadow)}
    .brand-dot{width:28px;height:28px;border:2px solid #fff;border-radius:50%;display:grid;place-items:center}
    .brand-dot::after{content:"";width:10px;height:10px;border-radius:50%;background:#fff}
    h1{font-size:22px;margin:0 6px 0 0}
    .btn{background:#08b4cf;color:#fff;border:none;border-radius:999px;padding:10px 16px;font-weight:600;box-shadow:var(--shadow);cursor:pointer}
    .btn:active{transform:scale(.98)}
    .btn-outline{background:#fff;color:#08b4cf;border:2px solid #9be7f1}
    .shell{max-width:980px;margin:0 auto;padding:18px}
    .panel{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);margin-bottom:18px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .slider{width:100%}
    .chip{background:var(--chip);border:1.5px solid var(--chipborder);padding:10px 14px;border-radius:999px;cursor:pointer;font-weight:600}
    .chip.active{background:#e9fbff;border-color:#97e4f0;color:#088aa1}
    .section-title{font-weight:800;margin:4px 0 10px 0}
    .big-btn{display:block;width:100%;text-align:center;padding:14px 18px;border-radius:14px;font-size:16px;font-weight:800}
    .map-wrap{height:300px;border-radius:16px;overflow:hidden}
    /* ==== 1) Majhni checkboxi, pred labelo (dostopni) ==== */
    .checkline{display:flex;align-items:center;gap:12px}
    .checkbox{
      appearance:none;
      width:18px;height:18px; /* manjši kvadratek */
      border:2px solid #08b4cf;border-radius:6px;
      display:inline-grid;place-items:center;cursor:pointer;position:relative;flex:none;
      background:#fff;
    }
    .checkbox:focus-visible{outline:3px solid var(--focus);outline-offset:2px}
    .checkbox::after{
      content:"";width:10px;height:10px;border-radius:3px;transform:scale(0);transition:120ms transform ease-in-out;background:#08b4cf;
    }
    .checkbox:checked::after{transform:scale(1)}
    label.checkbox-label{cursor:pointer;font-weight:600}
    /* ==== Izpostavljeni (carousel) ==== */
    .carousel{position:relative;overflow:hidden;border-radius:16px}
    .carousel-track{display:flex;transition:transform .6s ease}
    .feat-card{min-width:100%;display:grid;grid-template-columns:1fr 1fr}
    .feat-img{min-height:220px;background:#eef;object-fit:cover;width:100%;height:100%}
    .feat-body{padding:18px;background:#fff}
    .feat-title{font-size:18px;font-weight:800;margin:0 0 8px}
    .feat-meta{color:var(--muted);font-size:14px;margin-bottom:10px}
    .carousel-dots{position:absolute;bottom:10px;left:0;right:0;display:flex;gap:6px;justify-content:center}
    .dot{width:8px;height:8px;border-radius:50%;background:#d7f3f8;opacity:.7}
    .dot.active{background:#08b4cf;opacity:1}
    /* ==== Rezultati ==== */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
    .card{background:#fff;border-radius:16px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column}
    .card img{width:100%;height:150px;object-fit:cover;background:#eef}
    .card .body{padding:12px 14px 14px}
    .title{font-weight:800;margin:2px 0 6px}
    .muted{color:var(--muted);font-size:14px}
    .actions{display:flex;gap:8px;margin-top:10px}
    .link{display:inline-flex;align-items:center;gap:6px;padding:8px 10px;border-radius:999px;background:#e9fbff;border:1px solid #c5eef5;color:#066575;text-decoration:none;font-weight:700}
    /* ==== Modal (naročilo vstopnic) ==== */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:16px;z-index:60}
    .modal.open{display:flex}
    .dialog{background:#fff;border-radius:16px;max-width:660px;width:100%;box-shadow:var(--shadow)}
    .dialog header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #eef}
    .dialog h3{margin:0;font-size:18px}
    .dialog .content{padding:14px 16px;max-height:70vh;overflow:auto}
    .dialog .rowline{display:grid;grid-template-columns:1fr 120px 100px;gap:12px;align-items:center;margin-bottom:8px}
    .dialog footer{padding:14px 16px;border-top:1px solid #eef;display:flex;justify-content:flex-end;gap:10px}
    input[type="number"],input[type="text"],input[type="date"],select{
      padding:10px;border:1.6px solid #cfe1ee;border-radius:10px;font-size:14px;width:100%;box-sizing:border-box
    }
    .notice{background:#f1fdf6;border:1px solid #c7f2d6;color:#216a3d;padding:10px 12px;border-radius:10px}
    /* Date filter bar */
    .bar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    @media (max-width:780px){
      .feat-card{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header class="appbar">
    <div class="brand-dot" aria-hidden="true"></div>
    <h1>NearGo</h1>
    <div style="flex:1"></div>
    <button class="btn" id="btnOrganizer">Za organizatorje</button>
  </header>

  <main class="shell">
    <!-- NASTAVITVE & FILTRI -->
    <section class="panel" id="filters">
      <div class="section-title">Oddaljenost</div>
      <div class="row">
        <input id="radius" class="slider" type="range" min="1" max="300" step="1" value="30" />
        <strong><span id="radiusLabel">30</span> km</strong>
      </div>

      <div class="row" id="cats" style="margin-top:10px">
        <button class="chip active" data-cat="all">Vse</button>
        <button class="chip" data-cat="Koncert">Koncert</button>
        <button class="chip" data-cat="Kultura">Kultura</button>
        <button class="chip" data-cat="Otroci">Otroci</button>
        <button class="chip" data-cat="Hrana">Hrana</button>
        <button class="chip" data-cat="Narava">Narava</button>
        <button class="chip" data-cat="Šport">Šport</button>
        <button class="chip" data-cat="Biznis">Za podjetja</button>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="btnSearch" class="btn big-btn">Išči</button>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="btnUseLoc" class="btn btn-outline">Uporabi mojo trenutno lokacijo</button>
      </div>

      <div class="panel" style="margin:14px 0 0">
        <div class="section-title">Zemljevid</div>
        <div class="map-wrap" id="map" aria-label="Zemljevid dogodkov"></div>
      </div>

      <div class="row" style="margin-top:12px">
        <!-- 1) Checkbox pred labelo, manjši -->
        <div class="checkline">
          <input id="onlyFree" class="checkbox" type="checkbox" />
          <label for="onlyFree" class="checkbox-label">Samo brezplačni</label>
        </div>
      </div>
    </section>

    <!-- IZPOSTAVLJENI (počasi vrtenje) -->
    <section class="panel">
      <div class="section-title">Izpostavljeni dogodki</div>
      <div class="carousel" id="featCarousel" aria-roledescription="carousel">
        <div class="carousel-track" id="featTrack"></div>
        <div class="carousel-dots" id="featDots"></div>
      </div>
    </section>

    <!-- ORODJA ZA DODATNO FILTRIRANJE PO DATUMU (točka 6) -->
    <section class="panel" id="dateFilterPanel" style="display:none">
      <div class="bar">
        <div><strong>Filtriraj po datumu:</strong></div>
        <div>
          <label style="display:block;font-size:12px;color:var(--muted)">Od</label>
          <input type="date" id="dateFrom">
        </div>
        <div>
          <label style="display:block;font-size:12px;color:var(--muted)">Do</label>
          <input type="date" id="dateTo">
        </div>
        <button class="btn btn-outline" id="btnDateApply">Uveljavi</button>
        <button class="btn" id="btnDateClear">Počisti</button>
      </div>
    </section>

    <!-- REZULTATI -->
    <section class="panel">
      <div class="section-title">Rezultati iskanja</div>
      <div id="results" class="grid" aria-live="polite"></div>
    </section>

    <!-- ZAKAJ NearGo -->
    <section class="panel">
      <h3 style="margin:0 0 8px">Zakaj NearGo?</h3>
      <ul style="margin:8px 0 0 18px">
        <li><strong>Vsi dogodki na enem mestu</strong> – hitro brskanje in primerjava.</li>
        <li><strong>Vstopnice ali kupone</strong> lahko takoj kupiš ali shraniš.</li>
      </ul>
    </section>
  </main>

  <!-- MODAL: NAROČILO VSTOPNIC S TIERI (točka 5) -->
  <div class="modal" id="orderModal" role="dialog" aria-modal="true" aria-labelledby="orderTitle">
    <div class="dialog">
      <header>
        <h3 id="orderTitle">Nakup vstopnic</h3>
        <button class="btn btn-outline" id="orderClose">Zapri</button>
      </header>
      <div class="content">
        <div id="orderEventMeta" class="muted" style="margin-bottom:10px"></div>
        <div id="tiers"></div>
        <div id="orderNotice" class="notice" style="display:none;margin-top:10px"></div>
      </div>
      <footer>
        <button class="btn btn-outline" id="btnOrderFree" style="display:none">Registracija brez vstopnice</button>
        <button class="btn" id="btnCheckout">Nadaljuj na plačilo</button>
      </footer>
    </div>
  </div>

  <script>
    /*********** POMOČNE ***********/
    const $ = sel => document.querySelector(sel);
    const $$ = sel => [...document.querySelectorAll(sel)];

    const haversineKm = (a,b)=>{
      const toRad = d=>d*Math.PI/180;
      const R=6371, dLat=toRad(b.lat-a.lat), dLon=toRad(b.lng-a.lng);
      const lat1=toRad(a.lat), lat2=toRad(b.lat);
      const h = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)**2;
      return 2*R*Math.asin(Math.sqrt(h));
    };
    const todayISO = ()=> new Date().toISOString().slice(0,10);

    /*********** MAPA ***********/
    let map = L.map('map',{zoomControl:false}).setView([46.0569,14.5058], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
    let markersLayer = L.layerGroup().addTo(map);
    const drawMarkers = (events)=>{
      markersLayer.clearLayers();
      events.forEach(ev=>{
        L.marker([ev.lat, ev.lng]).addTo(markersLayer)
        .bindPopup(`<strong>${ev.title}</strong><br>${fmtDate(ev.start)} – ${fmtDate(ev.end)}<br>${ev.city||""}`);
      });
    };

    /*********** PODATKI ***********/
    // 3) Ne prikazujemo pretečenih: filtracija bo globalna (po end datumu)
    // Lokalno vnešeni dogodki (organizatorji) – shranjeni v localStorage pod 'neargo_events'
    const readLocalEvents = ()=>{
      try{
        return JSON.parse(localStorage.getItem('neargo_events')||'[]');
      }catch{ return []; }
    };

    // "Veliki appi" (primeri). Ti NISO prioriteta pred lokalnimi; mešamo jih šele, če ustrezajo filtru.
    const externalEvents = [
      {id:"x1",title:"Veliki koncert v LJ",cat:"Koncert",start:"2025-12-20",end:"2025-12-20",lat:46.0569,lng:14.5058,city:"Ljubljana",priceFrom:25,featured:true,cover:"https://images.unsplash.com/photo-1514525253161-7a46d19cd819?q=80&w=1200&auto=format&fit=crop"},
      {id:"x2",title:"Sejem hrane",cat:"Hrana",start:"2025-11-02",end:"2025-11-03",lat:46.2389,lng:15.2675,city:"Celje",priceFrom:0,featured:true,cover:"https://images.unsplash.com/photo-1478144592103-25e218a04891?q=80&w=1200&auto=format&fit=crop"},
      {id:"x3",title:"Družinski tek",cat:"Šport",start:"2025-10-09",end:"2025-10-09",lat:46.5547,lng:15.6459,city:"Maribor",priceFrom:10,featured:false,cover:"https://images.unsplash.com/photo-1540573133985-87b6da6d54a9?q=80&w=1200&auto=format&fit=crop"},
    ];

    // Privzeta lokacija (SLO) / aktualna lokacija
    let userLoc = {lat:46.0569,lng:14.5058};
    let currentCat = 'all';

    /*********** UI: checkbox & radius ***********/
    const radiusInput = $('#radius'), radiusLabel = $('#radiusLabel');
    radiusInput.addEventListener('input', e=> radiusLabel.textContent = e.target.value);

    // Kategorije
    $('#cats').addEventListener('click', e=>{
      const btn = e.target.closest('.chip'); if(!btn) return;
      $$('#cats .chip').forEach(c=>c.classList.remove('active'));
      btn.classList.add('active'); currentCat = btn.dataset.cat;
    });

    // Uporabi mojo lokacijo
    $('#btnUseLoc').addEventListener('click', ()=>{
      if(!navigator.geolocation){ alert('Brskalnik ne podpira geolokacije.'); return; }
      navigator.geolocation.getCurrentPosition(pos=>{
        userLoc = {lat:pos.coords.latitude, lng:pos.coords.longitude};
        map.setView([userLoc.lat,userLoc.lng], 10);
        L.circleMarker([userLoc.lat,userLoc.lng],{radius:6,color:'#08b4cf'}).addTo(map).bindPopup('Vaša lokacija');
      }, err=> alert('Lokacije ni mogoče pridobiti.'));
    });

    /*********** ISKANJE (točka 2 + 3 + 6) ***********/
    const fmtDate = d => new Date(d+"T00:00:00").toLocaleDateString('sl-SI');
    const isPast = ev => ev.end < todayISO(); // 3) izloči pretečene
    const byDateRange = (ev, from, to)=>{
      if(from && ev.end < from) return false;
      if(to && ev.start > to) return false;
      return true;
    };

    const preparePool = ()=>{
      // PRIORITETA: lokalni dogodki + zunanji (oba vira filtriramo z istimi pravili)
      const local = readLocalEvents();
      return [...local, ...externalEvents];
    };

    const search = (opts={})=>{
      const r = Number(radiusInput.value);
      const onlyFree = $('#onlyFree').checked;
      const from = $('#dateFrom').value || null;
      const to   = $('#dateTo').value   || null;

      const pool = preparePool()
        .filter(ev=>!isPast(ev)) // 3)
        .filter(ev=> currentCat==='all' ? true : ev.cat===currentCat)
        .filter(ev=> onlyFree ? (Number(ev.priceFrom||0)===0) : true)
        .filter(ev=> byDateRange(ev, from, to))
        .map(ev=>{
          const dist = haversineKm(userLoc, {lat:ev.lat,lng:ev.lng});
          return {...ev, dist:Math.round(dist)};
        })
        .filter(ev=> ev.dist <= r)  // 2) v bližini po izbranem radiju
        .sort((a,b)=> a.dist-b.dist || (a.start>b.start?1:-1));

      renderResults(pool);
      drawMarkers(pool);
      // prikaži bar za datum (točka 6) po prvi uspešni poizvedbi
      $('#dateFilterPanel').style.display = 'block';
    };

    $('#btnSearch').addEventListener('click', search);
    $('#btnDateApply').addEventListener('click', search);
    $('#btnDateClear').addEventListener('click', ()=>{
      $('#dateFrom').value = ''; $('#dateTo').value='';
      search();
    });

    /*********** RENDER: IZPOSTAVLJENI (točka 4 – počasneje) ***********/
    const renderFeatured = ()=>{
      const feat = preparePool().filter(e=>!isPast(e) && e.featured);
      const track = $('#featTrack'); const dots = $('#featDots');
      track.innerHTML = ''; dots.innerHTML='';
      feat.forEach((ev,i)=>{
        const el = document.createElement('div');
        el.className='feat-card';
        el.innerHTML = `
          <img class="feat-img" alt="" src="${ev.cover||''}">
          <div class="feat-body">
            <div class="feat-title">${ev.title}</div>
            <div class="feat-meta">${ev.city||''} • ${fmtDate(ev.start)}${ev.end!==ev.start?' – '+fmtDate(ev.end):''}</div>
            <div class="muted">Kategorija: ${ev.cat} • ${ev.priceFrom?('od '+ev.priceFrom.toFixed?ev.priceFrom.toFixed(2):ev.priceFrom+' €'):'Brezplačno'}</div>
            <div class="actions" style="margin-top:14px">
              <a class="link" href="#results" data-jump-buy="${ev.id}">Kupi / Podrobnosti</a>
            </div>
          </div>`;
        track.appendChild(el);
        const d = document.createElement('div'); d.className='dot'+(i===0?' active':''); dots.appendChild(d);
      });
      // Avto-rotacija: 7 sekund (upočasnjeno) – točka 4
      let idx=0, max=feat.length;
      const move=()=>{
        if(max===0) return;
        idx=(idx+1)%max;
        track.style.transform=`translateX(-${idx*100}%)`;
        $$('#featDots .dot').forEach((n,i)=> n.classList.toggle('active', i===idx));
      };
      window.__featTimer && clearInterval(window.__featTimer);
      window.__featTimer = setInterval(move, 7000);
      // klik na "Kupi" iz izpostavljenih zaskoči do kartice:
      document.addEventListener('click', e=>{
        const a = e.target.closest('[data-jump-buy]'); if(!a) return;
        e.preventDefault();
        const id = a.getAttribute('data-jump-buy');
        const btn = document.querySelector(`[data-buy="${id}"]`);
        if(btn){ btn.scrollIntoView({behavior:'smooth',block:'center'}); btn.focus(); }
      }, {once:true});
    };

    /*********** RENDER: RESULT KARTICE ***********/
    const renderResults = (list)=>{
      const wrap = $('#results'); wrap.innerHTML='';
      if(list.length===0){ wrap.innerHTML = `<div class="muted">Ni zadetkov za izbrane filtre.</div>`; return; }
      list.forEach(ev=>{
        const card = document.createElement('article');
        card.className='card';
        card.innerHTML = `
          <img alt="" src="${ev.cover||'https://images.unsplash.com/photo-1521335629791-ce4aec67dd53?q=80&w=1200&auto=format&fit=crop'}">
          <div class="body">
            <div class="title">${ev.title}</div>
            <div class="muted">${ev.city||''} • ${fmtDate(ev.start)}${ev.end!==ev.start?' – '+fmtDate(ev.end):''}</div>
            <div class="muted">Kategorija: ${ev.cat} • ${ev.dist} km • ${Number(ev.priceFrom||0)===0?'Brezplačno':'od '+ev.priceFrom+' €'}</div>
            <div class="actions">
              <a class="link" href="#" data-buy="${ev.id}">Kupi / Vstopnice</a>
            </div>
          </div>`;
        wrap.appendChild(card);
      });
    };

    /*********** NAKUP (točka 5) – več vrst vstopnic ***********/
    const findById = id => preparePool().find(e=>e.id===id);
    let orderEvent = null;

    document.addEventListener('click', (e)=>{
      const buy = e.target.closest('[data-buy]');
      if(buy){
        e.preventDefault();
        const id = buy.getAttribute('data-buy');
        orderEvent = findById(id);
        openOrder(orderEvent);
      }
    });

    const defaultTiers = (ev)=> ev.tiers?.length ? ev.tiers : [
      {name:'Odrasli', price: ev.priceFrom||0, currency:'EUR', max:10},
      {name:'Učenci/študenti', price: Math.max(0, (ev.priceFrom||0)-5), currency:'EUR', max:10},
      {name:'Upokojenci', price: Math.max(0, (ev.priceFrom||0)-7), currency:'EUR', max:10},
      {name:'Otroci', price:0, currency:'EUR', max:10}
    ];

    const openOrder = (ev)=>{
      $('#orderTitle').textContent = `Vstopnice – ${ev.title}`;
      $('#orderEventMeta').textContent = `${ev.city||''} • ${fmtDate(ev.start)}${ev.end!==ev.start?' – '+fmtDate(ev.end):''}`;
      const tiers = defaultTiers(ev);
      const cont = $('#tiers'); cont.innerHTML='';
      let hasPaidTier=false, hasFreeTier=false;
      tiers.forEach((t,idx)=>{
        if((t.price||0)>0) hasPaidTier=true; else hasFreeTier=true;
        const row = document.createElement('div');
        row.className='rowline';
        row.innerHTML = `
          <div><strong>${t.name}</strong><div class="muted">${(t.price||0)===0?'Brezplačno':(t.price.toFixed? t.price.toFixed(2):t.price)+' '+(t.currency||'EUR')}</div></div>
          <div><input type="number" min="0" max="${t.max||10}" value="0" data-tier-q="${idx}" /></div>
          <div><input type="text" placeholder="Ime in priimek" data-tier-name="${idx}" /></div>
        `;
        cont.appendChild(row);
      });
      // Opombe glede brezplačnih (ni generacije vstopnice)
      const notice = $('#orderNotice');
      if(hasFreeTier && !hasPaidTier){
        notice.style.display='block';
        notice.textContent='Dogodek je brezplačen. Za brezplačne udeležence se vstopnica NE generira – zabeležena bo registracija.';
        $('#btnOrderFree').style.display='inline-flex';
        $('#btnCheckout').style.display='none';
      }else{
        notice.style.display='none';
        $('#btnOrderFree').style.display='none';
        $('#btnCheckout').style.display='inline-flex';
      }
      $('#orderModal').classList.add('open');
    };

    $('#orderClose').addEventListener('click', ()=> $('#orderModal').classList.remove('open'));
    $('#btnOrderFree').addEventListener('click', ()=>{
      alert('Registracija zabeležena. Prejeli boste potrditev na e-pošto (brez vstopnice).');
      $('#orderModal').classList.remove('open');
    });

    // Plačilo – priprava podatkov za /api/checkout (Stripe) – brez sprememb obstoječih API-jev
    $('#btnCheckout').addEventListener('click', async ()=>{
      if(!orderEvent) return;
      const tiers = defaultTiers(orderEvent);
      const picks = tiers.map((t,i)=>{
        const q = Number(document.querySelector(`[data-tier-q="${i}"]`).value||0);
        const name = (document.querySelector(`[data-tier-name="${i}"]`).value||'').trim();
        return {name:t.name, price:t.price||0, currency:t.currency||'EUR', quantity:q, attendee:name};
      }).filter(x=>x.quantity>0);

      if(picks.length===0){ alert('Izberi vsaj eno vstopnico.'); return; }

      // če je med izbranimi kakšna brezplačna, zanjo ne generiramo vstopnice (samo registracija)
      const lineItems = picks.filter(p=>p.price>0).map(p=>({
        name:`${orderEvent.title} – ${p.name}`,
        amount: Math.round(p.price*100),
        currency: p.currency||'EUR',
        quantity: p.quantity
      }));

      try{
        const res = await fetch('/api/checkout',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
          eventId: orderEvent.id,
          items: lineItems,
          meta: {freeAttendees: picks.filter(p=>p.price===0)}
        })});
        if(!res.ok) throw new Error('Checkout napaka');
        const data = await res.json();
        if(data?.url) location.href = data.url;
        else alert('Plačilo pripravljeno. Sledite navodilom na naslednji strani.');
      }catch(e){
        alert('Ni mogoče odpreti plačila. Poskusite znova.');
      }
    });

    /*********** STARTUP ***********/
    renderFeatured();
    search(); // začetni prikaz
  </script>
  <footer style="background:#f0f7f9;color:#333;padding:20px;text-align:center;margin-top:30px;font-size:14px">
  <p>
    <a href="/legal.html#terms" style="color:#08b4cf;font-weight:600;text-decoration:none;margin:0 8px" target="_blank" rel="noopener">Pogoji uporabe</a> |
    <a href="/legal.html#privacy" style="color:#08b4cf;font-weight:600;text-decoration:none;margin:0 8px" target="_blank" rel="noopener">Politika zasebnosti</a> |
    <a href="/legal.html#refunds" style="color:#08b4cf;font-weight:600;text-decoration:none;margin:0 8px" target="_blank" rel="noopener">Vračila & odpovedi</a> |
    <a href="/legal.html#contact" style="color:#08b4cf;font-weight:600;text-decoration:none;margin:0 8px" target="_blank" rel="noopener">Kontakt & podpora</a>
  </p>
  <p style="margin-top:8px">© 2025 NearGo</p>
  </footer>
</body>
</html>
