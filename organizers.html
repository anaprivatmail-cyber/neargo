<!doctype html>
<html lang="sl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>NearGo – Za organizatorje</title>
  <style>
    :root{
      --bg:#f6fbfe; --card:#fff; --text:#0b1b2b; --muted:#5b6b7b; --border:#e3eef7;
      --brand:#0bbbd6; --brand2:#089ab1; --shadow:0 12px 30px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);
      font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{max-width:900px;margin:24px auto;padding:16px}
    .card{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:20px}
    h1{margin:6px 0 14px;font-size:24px}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr;gap:14px;margin-top:12px}
    @media(min-width:680px){ .grid{grid-template-columns:1fr 1fr 1fr} }
    .btn{
      display:block;text-align:center;text-decoration:none;border-radius:16px;
      padding:18px;font-weight:900;box-shadow:var(--shadow); transition:transform .06s ease
    }
    .btn:active{ transform:scale(.98); }
    .btn.primary{background:linear-gradient(90deg,var(--brand),var(--brand2)); color:#fff; border:0;}
    .btn.link{background:#fff;color:var(--text);border:1px solid var(--border)}
    .hint{font-size:12px;color:var(--muted);margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Za organizatorje</h1>
      <div class="muted">Izberi, kaj želiš narediti. Podatki (npr. stats token, ključ skenerja) se shranijo v tej napravi.</div>

      <div class="grid" style="margin-top:16px">
        <a id="btnPublish" class="btn link"   href="/#orgPanel">Objavi dogodek</a>
        <a id="btnScan"    class="btn primary" href="#">Skeniraj QR</a>
        <a id="btnStats"   class="btn link"   href="#">Analitika</a>
      </div>

      <div class="hint">
        Namig: če si v potrditvenem e-mailu že kliknil/a povezavo <i>Statistika</i> na tej napravi, je tvoj
        <b>stats token</b> že shranjen. Če ne, te bo stran prosila, da ga prilepiš.
      </div>
    </div>
  </div>

<script>
  // Helper za base URL (brez poševnice na koncu)
  const ORIGIN = location.origin.replace(/\/$/, "");

  // 1) Objavi dogodek – pusti anchor #orgPanel (glavna stran odpre panel)
  document.getElementById('btnPublish').addEventListener('click', (e)=>{
    // nič – anchor že kaže na /#orgPanel
  });

  // 2) Skeniraj QR – odpri scan.html in po možnosti prenesi znane parametre iz localStorage
  document.getElementById('btnScan').addEventListener('click', (e)=>{
    e.preventDefault();
    const p = new URLSearchParams();
    const k  = localStorage.getItem('scanner_key') || '';
    const ev = localStorage.getItem('event_id') || localStorage.getItem('default_event') || '';
    const st = localStorage.getItem('stats_token') || '';
    if (k)  p.set('k', k);
    if (ev) p.set('eventId', ev);
    if (st) p.set('stats', st);
    // ?v=2 obide PWA cache, če je SW
    location.href = `/scan.html?v=2${p.toString()?('&'+p.toString()):''}`;
  });

  // 3) Analitika – potrebuje stats token; če ga ni, ga povprašamo in shranimo
  document.getElementById('btnStats').addEventListener('click', async (e)=>{
    e.preventDefault();
    let stats = localStorage.getItem('stats_token') || '';
    if (!stats) {
      stats = prompt('Prilepi svoj stats token (iz potrditvenega e-maila):') || '';
      stats = stats.trim();
      if (!stats) return; // preklic
      localStorage.setItem('stats_token', stats);
    }
    const ev = localStorage.getItem('event_id') || localStorage.getItem('default_event') || '';
    const q = new URLSearchParams({ stats });
    if (ev) q.set('eventId', ev);
    location.href = `/org-stats.html?${q.toString()}`;
  });
</script>
</body>
</html>
